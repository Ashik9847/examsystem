{% extends 'controller_admin/base.html' %}
{% block page_title %}Edit Question - {{ question.exam.name }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card shadow">
            <div class="card-header bg-warning text-dark d-flex justify-content-between align-items-center">
                <h4 class="mb-0">
                    <i class="fas fa-edit me-2"></i> Edit Question
                </h4>
                <a href="{% url 'controller_admin:exam_detail' question.exam.id %}" class="btn btn-outline-dark btn-sm">
                    <i class="fas fa-arrow-left me-1"></i> Back to Exam
                </a>
            </div>
            <div class="card-body p-5">
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="mb-4">
                        <label class="form-label fw-bold fs-5">Question Text</label>
                        <textarea name="question_text" class="form-control form-control-lg" rows="5" required>{{ question.question_text }}</textarea>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold fs-5">Option Type</label>
                        <select name="option_type" id="option_type" class="form-select form-select-lg">
                            <option value="text" {% if question.option_type == 'text' %}selected{% endif %}>Text Options</option>
                            <option value="image" {% if question.option_type == 'image' %}selected{% endif %}>Image Options</option>
                        </select>
                    </div>

                    <div id="text_options" {% if question.option_type != 'text' %}style="display:none;"{% endif %}>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Option A</label>
                                <input type="text" name="option_a" value="{{ question.option_a }}" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Option B</label>
                                <input type="text" name="option_b" value="{{ question.option_b }}" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Option C</label>
                                <input type="text" name="option_c" value="{{ question.option_c }}" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Option D</label>
                                <input type="text" name="option_d" value="{{ question.option_d }}" class="form-control">
                            </div>
                        </div>
                    </div>

                    <div id="image_options" {% if question.option_type != 'image' %}style="display:none;"{% endif %}>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">Option A Image</label>
                                <input type="file" name="option_a_image" class="form-control" accept="image/*">
                                {% if question.option_a_image %}
                                    <small class="text-muted d-block mt-2">Current: <img src="{{ question.option_a_image.url }}" style="max-height:100px;" class="rounded"></small>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Option B Image</label>
                                <input type="file" name="option_b_image" class="form-control" accept="image/*">
                                {% if question.option_b_image %}
                                    <small class="text-muted d-block mt-2">Current: <img src="{{ question.option_b_image.url }}" style="max-height:100px;" class="rounded"></small>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Option C Image</label>
                                <input type="file" name="option_c_image" class="form-control" accept="image/*">
                                {% if question.option_c_image %}
                                    <small class="text-muted d-block mt-2">Current: <img src="{{ question.option_c_image.url }}" style="max-height:100px;" class="rounded"></small>
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Option D Image</label>
                                <input type="file" name="option_d_image" class="form-control" accept="image/*">
                                {% if question.option_d_image %}
                                    <small class="text-muted d-block mt-2">Current: <img src="{{ question.option_d_image.url }}" style="max-height:100px;" class="rounded"></small>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-6">
                            <label class="form-label fw-bold fs-5">Correct Answer</label>
                            <select name="correct_answer" class="form-select form-select-lg" required>
                                <option value="A" {% if question.correct_answer == 'A' %}selected{% endif %}>A</option>
                                <option value="B" {% if question.correct_answer == 'B' %}selected{% endif %}>B</option>
                                <option value="C" {% if question.correct_answer == 'C' %}selected{% endif %}>C</option>
                                <option value="D" {% if question.correct_answer == 'D' %}selected{% endif %}>D</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label fw-bold fs-5">Marks</label>
                            <input type="number" name="marks" value="{{ question.marks }}" step="0.1" min="0.1" class="form-control form-control-lg" required>
                        </div>
                    </div>

                    <hr class="my-5">

                    <div class="text-end">
                        <a href="{% url 'controller_admin:exam_detail' question.exam.id %}" class="btn btn-secondary btn-lg me-3 px-5">
                            <i class="fas fa-times me-2"></i> Cancel
                        </a>
                        <button type="submit" class="btn btn-warning btn-lg px-5 shadow">
                            <i class="fas fa-save me-2"></i> Update Question
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('option_type').addEventListener('change', function() {
        document.getElementById('text_options').style.display = this.value === 'text' ? 'block' : 'none';
        document.getElementById('image_options').style.display = this.value === 'image' ? 'block' : 'none';
    });
</script>
{% endblock %}